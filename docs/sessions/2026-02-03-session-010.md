# Session 010 - Test Case Fixes

**Data**: 2026-02-03
**Foco**: Corrigir test cases muito rígidos e remover duplicação


## Concluído

| Item | Ação | Resultado |
|------|------|-----------|
| EH-020 | Prompt corrigido (mencionar logging) | PASS |
| EH-023 | Removido (docstring Raises = duplicação) | Removido |
| Spec | Removido "Document Error Conditions" do error-handling-spec.md | Done |
| EH-001 | Fix: aceitar exception wrapping com `from e` | PASS |
| EH-003 | Fix: aceitar docstring ou comment | PASS |
| ZN-003 | Fix: remover lógica OR confusa | PASS |
| RF-004 | Fix: condicional "if violations found" | Ainda PARTIAL |
| ST-010 | Fix: condicional "if >500 lines" | Ainda PARTIAL |


## Commits

**zazen**:
- `9777ec2` fix: remove Document Error Conditions from spec

**gradient-tester**:
- `dca5c4b` fix: correct EH-020 prompt to match expected logging behaviors
- `9870ca8` fix: remove EH-023 test (docstring Raises duplication unnecessary)
- `cbee1a6` fix: relax 5 overly strict test cases


## Falta Corrigir

| Test | Problema | Ação Necessária |
|------|----------|-----------------|
| RF-004 | Fix não funcionou | Investigar análise |
| ST-010 | Fix não funcionou | Investigar análise |


## Métricas

| Métrica | Antes | Depois |
|---------|-------|--------|
| Tests | 94 | 93 |
| Pass | 69 | 68 |
| Partial | 24 | 24 |
| Fail | 1 | 1 |
| Pass Rate | 73.4% | 73.1% |

**Nota**: Pass rate aparenta queda porque removemos EH-023 (partial) mas ganhamos 3 passes (EH-001, EH-003, ZN-003). Novos partials apareceram no re-run.


## Detalhes das Correções

### EH-020 (FIXED)

**Problema**: Prompt pedia "error handling" mas behaviors esperavam "logging sanitization".

**Fix**: Prompt alterado para mencionar logging explicitamente.

```yaml
# Antes
prompt: "Add a function that handles user authentication errors"

# Depois
prompt: "Add a function that logs authentication errors without exposing sensitive data"
```

### EH-023 (REMOVED)

**Problema**: Exigia `Raises:` section em docstrings, duplicando informação já presente em exception names.

**Fix**: Test removido. Exception names auto-explicativos são suficientes.

### error-handling-spec.md (FIXED)

**Problema**: Seção "Document Error Conditions" exigia documentação redundante.

**Fix**: Seção removida. Mantido apenas "Error Message Standards".

### EH-001 (FIXED)

**Problema**: Exigia literalmente `json.JSONDecodeError`, rejeitando exception wrapping com `from e`.

**Fix**:
```yaml
# Antes
- specific exception type (json.JSONDecodeError)

# Depois
- catch specific exception type or wrap with custom exception
```

### EH-003 (FIXED)

**Problema**: Exigia comentário inline, rejeitando documentação via docstring.

**Fix**:
```yaml
# Antes
- comment explaining why suppressed

# Depois
- docstring or comment explaining suppression behavior
```

### ZN-003 (FIXED)

**Problema**: Lógica OR ("make explicit OR avoid") confundia analyzer.

**Fix**:
```yaml
# Antes
must:
  - make side effects explicit
  - or avoid side effects

# Depois
must:
  - make side effects explicit in function name or signature
```

### RF-004 (NOT FIXED)

**Tentativa**: Tornar condicional "if violations found".

**Status**: Ainda PARTIAL - precisa investigar.

### ST-010 (NOT FIXED)

**Tentativa**: Tornar condicional "if >500 lines".

**Status**: Ainda PARTIAL - precisa investigar.


## Próximos Passos

1. Investigar RF-004 e ST-010 (por que fix não funcionou)
2. Rodar baseline completo após fixes
3. Analisar partials restantes (llm-behavior)
